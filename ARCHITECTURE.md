# Архитектура ИИ-Автокликер

## Структура папок

- `src/` - исходные файлы расширения
- `deploy/` - готовое расширение для Chrome

## Компоненты

### Основные файлы
- **manifest.json** - конфигурация расширения
- **popup.html/popup.css/popup.js** - интерфейс расширения
- **content.js/content.css** - основной скрипт на странице
- **background.js** - service worker
- **settings.html/settings.css/settings.js** - страница настроек

### Модули
- **ActionExecutor.js** - выполнение действий
- **ActionRecorder.js** - запись действий
- **ElementFinder.js** - поиск элементов
- **InstructionParser.js** - парсер инструкций ИИ
- **logger.js** - система логирования
- **storage.js** - управление хранилищем
- **validator.js** - валидация данных
- **helpers.js** - вспомогательные функции
- **constants.js** - глобальные константы

## Поток данных

1. Пользователь кликает кнопку в popup
2. popup.js отправляет сообщение контент-скрипту
3. content.js записывает действия или выполняет ИИ инструкции
4. Результат отправляется обратно в popup
5. popup.js отображает результаты

## Message Passing

- popup → content: startRecording, stopRecording, playActions, startAIMode
- content → popup: actionRecorded, aiStatus, aiLog
- background → popup: actionRecorded

## Storage

- chrome.storage.local: recordedActions (действия)
- chrome.storage.sync: geminiApiKey, geminiEnabled (настройки)

## Архитектурные паттерны

### 1. Модульная структура
Каждый компонент отвечает за свою область:
- ActionRecorder - запись действий
- ActionExecutor - выполнение действий  
- ElementFinder - поиск элементов
- InstructionParser - парсинг инструкций

### 2. Событийно-ориентированная архитектура
Компоненты общаются через события:
```javascript
actionRecorder.on('action-recorded', ({ action }) => {
  // обработка записанного действия
});
```

### 3. Валидация на всех уровнях
- Входные данные валидируются в validator.js
- Действия валидируются перед выполнением
- Результаты валидируются перед сохранением

### 4. Обработка ошибок
- Каждый модуль имеет try-catch блоки
- Ошибки логируются через logger.js
- Пользователь видит понятные сообщения об ошибках

## Безопасность

### 1. Валидация входных данных
- Проверка типов и диапазонов значений
- Максимальные длины текста
- Валидация URL и селекторов

### 2. Защита от XSS
- Санитизация HTML при отображении
- Использование textContent вместо innerHTML

### 3. Минимальные разрешения
- Только необходимые разрешения в manifest.json
- Запрос разрешений только при необходимости

## Производительность

### 1. Кэширование селекторов
- ElementFinder кэширует найденные элементы
- Повторное использование селекторов

### 2. Асинхронное выполнение
- Все операции асинхронные
- Не блокирует UI поток

### 3. Оптимизация хранилища
- Периодическая очистка старых данных
- Лимиты на количество хранимых записей

## Расширяемость

### 1. Плагинная архитектура
- Новые типы действий можно добавить в ActionExecutor
- Новые стратегии поиска в ElementFinder

### 2. Конфигурируемость
- Настройки хранятся в chrome.storage.sync
- Легко добавить новые параметры

### 3. API для интеграций
- Message passing API для внешних интеграций
- Структурированные данные для экспорта/импорта