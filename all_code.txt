/**
 * ========================================================================================
 * Ğ˜Ğ˜-ĞĞ’Ğ¢ĞĞšĞ›Ğ˜ĞšĞ•Ğ  v1.0.1 - Ğ’Ğ•Ğ¡Ğ¬ ĞšĞĞ” Ğ’ ĞĞ”ĞĞĞœ Ğ¤ĞĞ™Ğ›Ğ•
 * ========================================================================================
 * 
 * Ğ˜ĞĞ¡Ğ¢Ğ Ğ£ĞšĞ¦Ğ˜Ğ¯ ĞŸĞ Ğ˜Ğ¡ĞŸĞĞ›Ğ¬Ğ—ĞĞ’ĞĞĞ˜Ğ®:
 * 1. Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ğ²ĞµÑÑŒ ÑÑ‚Ğ¾Ñ‚ Ñ„Ğ°Ğ¹Ğ»
 * 2. Ğ Ğ°Ğ·Ğ´ĞµĞ»Ğ¸Ñ‚Ğµ Ğ¿Ğ¾ ÑĞµĞºÑ†Ğ¸ÑĞ¼ (ÑĞ¼. Ğ½Ğ¸Ğ¶Ğµ):
 *    - manifest.json (JSON)
 *    - popup.html (HTML)
 *    - popup.css (CSS)
 *    - popup.js (JavaScript)
 *    - enhanced-content.js (JavaScript)
 *    - gemini-api.js (JavaScript)
 *    - settings.html (HTML)
 *    - settings.js (JavaScript)
 *    - background.js (JavaScript)
 *    - content.css (CSS)
 * 3. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚Ğµ ĞºĞ°Ğ¶Ğ´ÑƒÑ ÑĞµĞºÑ†Ğ¸Ñ Ğ² Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ» Ñ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ñ‹Ğ¼ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼
 * 4. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ¿Ğ°Ğ¿ĞºÑƒ images/ Ñ Ğ¸ĞºĞ¾Ğ½ĞºĞ°Ğ¼Ğ¸ (icon16.png, icon48.png, icon128.png)
 * 
 * ========================================================================================
 */

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘ 1. manifest.json - ĞšĞĞĞ¤Ğ˜Ğ“Ğ£Ğ ĞĞ¦Ğ˜Ğ¯ Ğ ĞĞ¡Ğ¨Ğ˜Ğ Ğ•ĞĞ˜Ğ¯                                        â•‘
// â•‘    Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ ĞºĞ°Ğº: manifest.json                                                   â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

{
  "manifest_version": 3,
  "name": "Ğ˜Ğ˜-ĞĞ²Ñ‚Ğ¾ĞºĞ»Ğ¸ĞºĞµÑ€",
  "version": "1.0.1",
  "description": "ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹ Ğ½Ğ° Ğ²ĞµĞ±-ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°Ñ… Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ¾Ğ¹ Google Gemini Ğ˜Ğ˜",
  
  "permissions": [
    "activeTab",
    "scripting",
    "storage"
  ],
  
  "action": {
    "default_popup": "popup.html",
    "default_title": "Ğ˜Ğ˜-ĞĞ²Ñ‚Ğ¾ĞºĞ»Ğ¸ĞºĞµÑ€",
    "default_icon": {
      "16": "images/icon16.png",
      "48": "images/icon48.png",
      "128": "images/icon128.png"
    }
  },
  
  "background": {
    "service_worker": "background.js"
  },
  
  "content_scripts": [
    {
      "matches": ["<all_urls>"],
      "js": ["gemini-api.js", "enhanced-content.js"],
      "css": ["content.css"],
      "run_at": "document_start"
    }
  ],
  
  "host_permissions": [
    "<all_urls>",
    "https://generativelanguage.googleapis.com/*"
  ],
  
  "options_page": "settings.html",
  
  "icons": {
    "16": "images/icon16.png",
    "48": "images/icon48.png",
    "128": "images/icon128.png"
  }
}

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘ 2. popup.html - HTML Ğ˜ĞĞ¢Ğ•Ğ Ğ¤Ğ•Ğ™Ğ¡ Ğ ĞĞ¡Ğ¨Ğ˜Ğ Ğ•ĞĞ˜Ğ¯                                         â•‘
// â•‘    Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ ĞºĞ°Ğº: popup.html                                                      â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ğ˜Ğ˜-ĞĞ²Ñ‚Ğ¾ĞºĞ»Ğ¸ĞºĞµÑ€</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="popup-container">
    <div class="header">
      <h1>Ğ˜Ğ˜-ĞĞ²Ñ‚Ğ¾ĞºĞ»Ğ¸ĞºĞµÑ€</h1>
      <button id="settings-btn" class="settings-btn">âš™ï¸</button>
    </div>

    <div class="mode-selector">
      <button id="mode-manual" class="mode-btn active">Ğ ÑƒÑ‡Ğ½Ğ¾Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼</button>
      <button id="mode-auto" class="mode-btn">ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹</button>
    </div>

    <div id="manual-mode" class="mode-content active">
      <div class="controls">
        <button id="start-recording" class="btn-primary">ğŸ”´ ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ</button>
        <button id="stop-recording" class="btn-secondary" disabled>â¹ï¸ ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ</button>
      </div>
      <div class="actions-list">
        <h3>Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ğ½Ğ½Ñ‹Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ:</h3>
        <div id="actions-container"></div>
        <button id="clear-actions" class="btn-danger">ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ</button>
      </div>
    </div>

    <div id="auto-mode" class="mode-content">
      <div class="ai-panel">
        <h3>Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ğ˜Ğ˜</h3>
        <textarea id="ai-instructions" placeholder="ĞĞ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ, Ñ‡Ñ‚Ğ¾ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ğµ. ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: 'ĞšĞ»Ğ¸ĞºĞ½Ğ¸ Ğ½Ğ° ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ğ²Ğ¾Ğ¹Ñ‚Ğ¸, Ğ²Ğ²ĞµĞ´Ğ¸ Ğ»Ğ¾Ğ³Ğ¸Ğ½, Ğ·Ğ°Ñ‚ĞµĞ¼ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ Ğ¸ Ğ½Ğ°Ğ¶Ğ¼Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ'"></textarea>
        <button id="start-auto" class="btn-primary">â–¶ï¸ Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ</button>
        <button id="stop-auto" class="btn-secondary" disabled>â¹ï¸ ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ</button>
      </div>
      <div class="status">
        <div id="status-text">Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ: Ğ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ</div>
        <div id="status-log"></div>
      </div>
    </div>

    <div class="playback">
      <h3>Ğ’Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ:</h3>
      <input type="range" id="playback-speed" min="0.5" max="3" step="0.5" value="1">
      <span id="speed-label">1x</span>
      <button id="play-actions" class="btn-primary" disabled>â–¶ï¸ Ğ’Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²ĞµÑÑ‚Ğ¸</button>
    </div>
  </div>

  <script src="popup.js"></script>
</body>
</html>

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘ 3. popup.css - Ğ¡Ğ¢Ğ˜Ğ›Ğ˜ Ğ˜ĞĞ¢Ğ•Ğ Ğ¤Ğ•Ğ™Ğ¡Ğ                                                   â•‘
// â•‘    Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ ĞºĞ°Ğº: popup.css                                                       â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  width: 400px;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #333;
}

.popup-container {
  padding: 12px;
  background: #f8f9fa;
  border-radius: 8px;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
  border-bottom: 2px solid #667eea;
  padding-bottom: 8px;
}

.header h1 {
  font-size: 18px;
  color: #667eea;
}

.settings-btn {
  background: none;
  border: none;
  font-size: 18px;
  cursor: pointer;
  transition: transform 0.2s;
}

.settings-btn:hover {
  transform: rotate(20deg);
}

.mode-selector {
  display: flex;
  gap: 8px;
  margin-bottom: 12px;
  background: #fff;
  padding: 8px;
  border-radius: 6px;
}

.mode-btn {
  flex: 1;
  padding: 8px 12px;
  border: 2px solid #ddd;
  background: #fff;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s;
  font-weight: 500;
}

.mode-btn.active {
  background: #667eea;
  color: white;
  border-color: #667eea;
}

.mode-btn:hover {
  border-color: #667eea;
}

.mode-content {
  display: none;
  animation: fadeIn 0.3s ease-in;
}

.mode-content.active {
  display: block;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.controls {
  display: flex;
  gap: 8px;
  margin-bottom: 12px;
}

.btn-primary, .btn-secondary, .btn-danger {
  flex: 1;
  padding: 10px 12px;
  border: none;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-primary {
  background: #667eea;
  color: white;
}

.btn-primary:hover:not(:disabled) {
  background: #5568d3;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.btn-primary:disabled {
  background: #ccc;
  cursor: not-allowed;
}

.btn-secondary {
  background: #6c757d;
  color: white;
}

.btn-secondary:hover:not(:disabled) {
  background: #5a6268;
}

.btn-secondary:disabled {
  background: #ccc;
  cursor: not-allowed;
}

.btn-danger {
  background: #dc3545;
  color: white;
}

.btn-danger:hover {
  background: #c82333;
}

.actions-list {
  background: #fff;
  padding: 10px;
  border-radius: 6px;
  margin-bottom: 12px;
  max-height: 200px;
  overflow-y: auto;
}

.actions-list h3 {
  font-size: 12px;
  color: #666;
  margin-bottom: 6px;
  text-transform: uppercase;
}

.action-item {
  background: #f0f1ff;
  padding: 8px;
  margin-bottom: 6px;
  border-radius: 4px;
  border-left: 3px solid #667eea;
  font-size: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.action-text {
  flex: 1;
  color: #333;
}

.action-remove {
  background: #ff6b6b;
  color: white;
  border: none;
  border-radius: 3px;
  padding: 3px 6px;
  font-size: 10px;
  cursor: pointer;
  transition: background 0.2s;
}

.action-remove:hover {
  background: #ee5a52;
}

.ai-panel {
  background: #fff;
  padding: 12px;
  border-radius: 6px;
  margin-bottom: 12px;
}

.ai-panel h3 {
  font-size: 14px;
  color: #333;
  margin-bottom: 8px;
}

#ai-instructions {
  width: 100%;
  height: 100px;
  padding: 8px;
  border: 2px solid #ddd;
  border-radius: 4px;
  font-size: 12px;
  font-family: 'Segoe UI', Arial, sans-serif;
  resize: vertical;
  margin-bottom: 10px;
  transition: border-color 0.2s;
}

#ai-instructions:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.status {
  background: #fff;
  padding: 12px;
  border-radius: 6px;
  margin-bottom: 12px;
}

#status-text {
  font-size: 13px;
  color: #667eea;
  font-weight: 600;
  margin-bottom: 8px;
}

#status-log {
  font-size: 11px;
  color: #666;
  max-height: 120px;
  overflow-y: auto;
  background: #f8f9fa;
  padding: 8px;
  border-radius: 4px;
  border-left: 2px solid #667eea;
}

.log-entry {
  margin-bottom: 4px;
  line-height: 1.4;
}

.log-success { color: #28a745; }
.log-error { color: #dc3545; }

.playback {
  background: #fff;
  padding: 10px;
  border-radius: 6px;
}

.playback h3 {
  font-size: 12px;
  color: #666;
  margin-bottom: 8px;
  text-transform: uppercase;
}

#playback-speed {
  width: 70%;
  margin-right: 8px;
  cursor: pointer;
}

#speed-label {
  font-size: 12px;
  color: #667eea;
  font-weight: 600;
  min-width: 20px;
  display: inline-block;
}

::-webkit-scrollbar {
  width: 6px;
}

::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 3px;
}

::-webkit-scrollbar-thumb {
  background: #667eea;
  border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
  background: #5568d3;
}

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘ 4. popup.js - Ğ›ĞĞ“Ğ˜ĞšĞ Ğ˜ĞĞ¢Ğ•Ğ Ğ¤Ğ•Ğ™Ğ¡Ğ (Ğ¡ GEMINI)                                        â•‘
// â•‘    Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ ĞºĞ°Ğº: popup.js                                                        â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let isRecording = false;
let recordedActions = [];
let isAutoMode = false;
let geminiAssistant = null;

const startRecordingBtn = document.getElementById('start-recording');
const stopRecordingBtn = document.getElementById('stop-recording');
const playActionsBtn = document.getElementById('play-actions');
const clearActionsBtn = document.getElementById('clear-actions');
const actionsContainer = document.getElementById('actions-container');
const modeManual = document.getElementById('mode-manual');
const modeAuto = document.getElementById('mode-auto');
const manualModeDiv = document.getElementById('manual-mode');
const autoModeDiv = document.getElementById('auto-mode');
const startAutoBtn = document.getElementById('start-auto');
const stopAutoBtn = document.getElementById('stop-auto');
const aiInstructions = document.getElementById('ai-instructions');
const statusText = document.getElementById('status-text');
const statusLog = document.getElementById('status-log');
const playbackSpeed = document.getElementById('playback-speed');
const speedLabel = document.getElementById('speed-label');
const settingsBtn = document.getElementById('settings-btn');

document.addEventListener('DOMContentLoaded', () => {
  loadGeminiAssistant();
  loadSavedActions();
  setupEventListeners();
});

function loadGeminiAssistant() {
  chrome.storage.sync.get(['geminiApiKey', 'geminiEnabled'], (result) => {
    if (result.geminiEnabled && result.geminiApiKey) {
      geminiAssistant = {
        apiKey: result.geminiApiKey,
        enabled: true
      };
      addLog('âœ“ Gemini Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ°', 'success');
    }
  });
}

function setupEventListeners() {
  modeManual.addEventListener('click', switchToManualMode);
  modeAuto.addEventListener('click', switchToAutoMode);
  startRecordingBtn.addEventListener('click', startRecording);
  stopRecordingBtn.addEventListener('click', stopRecording);
  clearActionsBtn.addEventListener('click', clearActions);
  playActionsBtn.addEventListener('click', playActions);
  startAutoBtn.addEventListener('click', startAutoMode);
  stopAutoBtn.addEventListener('click', stopAutoMode);
  playbackSpeed.addEventListener('change', updateSpeedLabel);
  settingsBtn.addEventListener('click', openSettings);
}

function switchToManualMode() {
  isAutoMode = false;
  modeManual.classList.add('active');
  modeAuto.classList.remove('active');
  manualModeDiv.classList.add('active');
  autoModeDiv.classList.remove('active');
}

function switchToAutoMode() {
  isAutoMode = true;
  modeAuto.classList.add('active');
  modeManual.classList.remove('active');
  autoModeDiv.classList.add('active');
  manualModeDiv.classList.remove('active');
}

function startRecording() {
  isRecording = true;
  recordedActions = [];
  actionsContainer.innerHTML = '';
  startRecordingBtn.disabled = true;
  stopRecordingBtn.disabled = false;
  playActionsBtn.disabled = true;
  addLog('ğŸ”´ Ğ—Ğ°Ğ¿Ğ¸ÑÑŒ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ°ÑÑŒ', 'info');
  
  chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {
    chrome.tabs.sendMessage(tabs[0].id, { action: 'startRecording' });
  });
}

function stopRecording() {
  isRecording = false;
  startRecordingBtn.disabled = false;
  stopRecordingBtn.disabled = true;
  if (recordedActions.length > 0) {
    playActionsBtn.disabled = false;
  }
  addLog(`â¹ï¸ Ğ—Ğ°Ğ¿Ğ¸ÑÑŒ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ° (${recordedActions.length} Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹)`, 'success');
  
  chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {
    chrome.tabs.sendMessage(tabs[0].id, { action: 'stopRecording' });
  });
  saveActions();
}

function clearActions() {
  if (confirm('Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ğ½Ğ½Ñ‹Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ?')) {
    recordedActions = [];
    actionsContainer.innerHTML = '';
    playActionsBtn.disabled = true;
    startRecordingBtn.disabled = false;
    addLog('ğŸ—‘ï¸ Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ñ‹', 'info');
  }
}

function playActions() {
  const speed = parseFloat(playbackSpeed.value);
  chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {
    chrome.tabs.sendMessage(tabs[0].id, {
      action: 'playActions',
      actions: recordedActions,
      speed: speed
    });
  });
  addLog(`â–¶ï¸ Ğ’Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ Ñ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒÑ ${speed}x`, 'info');
}

function updateSpeedLabel() {
  speedLabel.textContent = playbackSpeed.value + 'x';
}

function saveActions() {
  chrome.storage.local.set({ recordedActions });
}

function loadSavedActions() {
  chrome.storage.local.get(['recordedActions'], (result) => {
    if (result.recordedActions) {
      recordedActions = result.recordedActions;
      renderActionsList();
      if (recordedActions.length > 0) {
        playActionsBtn.disabled = false;
      }
    }
  });
}

function renderActionsList() {
  actionsContainer.innerHTML = '';
  recordedActions.forEach((action, index) => {
    addActionToUI(action, index);
  });
}

function addActionToUI(action, index) {
  const actionItem = document.createElement('div');
  actionItem.className = 'action-item';

  let actionText = '';
  switch (action.type) {
    case 'click':
      actionText = `ĞšĞ»Ğ¸Ğº: ${action.selector || action.text || 'ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚'}`;
      break;
    case 'input':
      actionText = `Ğ’Ğ²Ğ¾Ğ´: "${action.value || ''}"`;
      break;
    case 'hover':
      actionText = `ĞĞ°Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ: ${action.selector}`;
      break;
    case 'scroll':
      actionText = `ĞŸÑ€Ğ¾ĞºÑ€ÑƒÑ‚ĞºĞ° Ğ½Ğ° ${action.y}px`;
      break;
    case 'wait':
      actionText = `ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ ${action.duration}ms`;
      break;
    default:
      actionText = action.type;
  }

  actionItem.innerHTML = `
    <span class="action-text">${actionText}</span>
    <button class="action-remove" onclick="removeAction(${index})">âœ•</button>
  `;

  actionsContainer.appendChild(actionItem);
}

window.removeAction = function(index) {
  recordedActions.splice(index, 1);
  renderActionsList();
  saveActions();
  if (recordedActions.length === 0) {
    playActionsBtn.disabled = true;
  }
};

async function startAutoMode() {
  const instructions = aiInstructions.value.trim();
  if (!instructions) {
    addLog('âš ï¸ Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¸', 'error');
    return;
  }

  startAutoBtn.disabled = true;
  stopAutoBtn.disabled = false;
  statusText.textContent = 'Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ: Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒÑ...';
  statusLog.innerHTML = '';

  addLog('ğŸ¤– ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒÑ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¸...', 'info');

  if (geminiAssistant?.enabled) {
    try {
      addLog('ğŸ“¡ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑÑ Ğ² Gemini...', 'info');
    } catch (error) {
      addLog(`âš ï¸ ĞÑˆĞ¸Ğ±ĞºĞ° Gemini: ${error.message}`, 'error');
    }
  }

  chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {
    chrome.tabs.sendMessage(tabs[0].id, {
      action: 'startAIMode',
      instructions: instructions,
      useGemini: geminiAssistant?.enabled || false,
      geminiApiKey: geminiAssistant?.apiKey || null
    });
  });
}

function stopAutoMode() {
  startAutoBtn.disabled = false;
  stopAutoBtn.disabled = true;
  statusText.textContent = 'Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ: Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾';
  addLog('â¸ï¸ Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾', 'info');

  chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {
    chrome.tabs.sendMessage(tabs[0].id, { action: 'stopAIMode' });
  });
}

function addLog(message, level = 'info') {
  const logEntry = document.createElement('div');
  logEntry.className = `log-entry log-${level}`;
  const time = new Date().toLocaleTimeString('ru-RU', { 
    hour: '2-digit', 
    minute: '2-digit', 
    second: '2-digit' 
  });
  logEntry.innerHTML = `<span style="opacity:0.6;font-size:10px;">[${time}]</span> ${message}`;
  statusLog.appendChild(logEntry);
  statusLog.scrollTop = statusLog.scrollHeight;
}

function openSettings() {
  chrome.runtime.openOptionsPage();
}

chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
  if (request.type === 'actionRecorded') {
    recordedActions.push(request.data);
    addActionToUI(request.data, recordedActions.length - 1);
    saveActions();
  } else if (request.type === 'aiStatus') {
    statusText.textContent = `Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ: ${request.status}`;
    if (request.message) {
      addLog(request.message, request.level || 'info');
    }
  } else if (request.type === 'aiLog') {
    addLog(request.message, request.level || 'info');
  }
});

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘ 5. gemini-api.js - Ğ˜ĞĞ¢Ğ•Ğ“Ğ ĞĞ¦Ğ˜Ğ¯ GOOGLE GEMINI API                                   â•‘
// â•‘    Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ ĞºĞ°Ğº: gemini-api.js                                                   â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class GeminiAIAssistant {
  constructor(apiKey) {
    this.apiKey = apiKey;
    this.apiEndpoint = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent';
    this.conversationHistory = [];
  }

  async analyzeInstructions(userInstructions, pageContext = '') {
    try {
      const systemPrompt = `Ğ¢Ñ‹ - Ğ°ÑÑĞ¸ÑÑ‚ĞµĞ½Ñ‚ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ²ĞµĞ±-Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹. 
ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ´Ğ°ĞµÑ‚ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¸ Ğ½Ğ° ĞµÑÑ‚ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾Ğ¼ ÑĞ·Ñ‹ĞºĞµ. 
Ğ¢Ğ²Ğ¾Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ° Ñ€Ğ°Ğ·Ğ±Ğ¸Ñ‚ÑŒ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¸ Ğ½Ğ° Ñ‚Ğ¾Ñ‡Ğ½Ñ‹Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ JSON.

ĞÑ‚Ğ²ĞµÑ‚ÑŒ Ğ¢ĞĞ›Ğ¬ĞšĞ JSON Ğ¼Ğ°ÑÑĞ¸Ğ²Ğ¾Ğ¼ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹, Ğ±ĞµĞ· Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ñ‚ĞµĞºÑÑ‚Ğ°.
ĞšĞ°Ğ¶Ğ´Ğ¾Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ¸Ğ¼ĞµÑ‚ÑŒ:
{
  "type": "click|input|select|scroll|wait",
  "target": "Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ° Ğ¸Ğ»Ğ¸ Ñ‚ĞµĞºÑÑ‚ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸",
  "value": "Ğ´Ğ»Ñ input - Ñ‚ĞµĞºÑÑ‚ Ğ´Ğ»Ñ Ğ²Ğ²Ğ¾Ğ´Ğ°",
  "description": "ĞºÑ€Ğ°Ñ‚ĞºĞ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼"
}`;

      const userMessage = `ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹: ${pageContext || 'Ğ½ĞµĞ¸Ğ·Ğ²ĞµÑÑ‚ĞµĞ½'}
    
Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ: ${userInstructions}

Ğ Ğ°Ğ·Ğ±ĞµĞ¹ ÑÑ‚Ğ¸ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¸ Ğ½Ğ° Ñ‚Ğ¾Ñ‡Ğ½Ñ‹Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ.`;

      const response = await this._callGeminiAPI(userMessage, systemPrompt);
      
      try {
        const jsonMatch = response.match(/\[[\s\S]*\]/);
        if (jsonMatch) {
          return JSON.parse(jsonMatch[0]);
        }
      } catch (e) {
        console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³Ğ° JSON:', e);
        return this._fallbackParse(userInstructions);
      }
    } catch (error) {
      console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğµ Gemini:', error);
      return this._fallbackParse(userInstructions);
    }
  }

  async _callGeminiAPI(message, systemPrompt = '') {
    if (!this.apiKey) {
      throw new Error('API ĞºĞ»ÑÑ‡ Gemini Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½');
    }

    const payload = {
      contents: [
        {
          parts: [
            {
              text: (systemPrompt ? systemPrompt + '\n\n' : '') + message
            }
          ]
        }
      ],
      generationConfig: {
        temperature: 0.7,
        topK: 40,
        topP: 0.95,
        maxOutputTokens: 2048,
      },
      safetySettings: [
        {
          category: 'HARM_CATEGORY_HARASSMENT',
          threshold: 'BLOCK_NONE',
        },
        {
          category: 'HARM_CATEGORY_HATE_SPEECH',
          threshold: 'BLOCK_NONE',
        },
        {
          category: 'HARM_CATEGORY_SEXUALLY_EXPLICIT',
          threshold: 'BLOCK_NONE',
        },
        {
          category: 'HARM_CATEGORY_DANGEROUS_CONTENT',
          threshold: 'BLOCK_NONE',
        },
      ],
    };

    try {
      const response = await fetch(
        `${this.apiEndpoint}?key=${this.apiKey}`,
        {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(payload),
        }
      );

      if (!response.ok) {
        const error = await response.json();
        throw new Error(`API Error: ${error.error?.message || response.statusText}`);
      }

      const data = await response.json();
      return data.candidates[0]?.content?.parts[0]?.text || '';
    } catch (error) {
      console.error('Gemini API Error:', error);
      throw error;
    }
  }

  _fallbackParse(instructions) {
    const actions = [];
    const lines = instructions.split('\n').filter(l => l.trim());

    for (const line of lines) {
      const lower = line.toLowerCase();

      if (lower.includes('ĞºĞ»Ğ¸Ğº') || lower.includes('Ğ½Ğ°Ğ¶Ğ¼Ğ¸')) {
        const match = line.match(/'([^']+)'|"([^"]+)"|Â«([^Â«]+)Â»/);
        const text = match ? (match[1] || match[2] || match[3]) : line;
        if (text && text.trim().length > 0) {
          actions.push({
            type: 'click',
            target: text.trim(),
            description: `ĞšĞ»Ğ¸Ğº Ğ½Ğ° "${text.trim()}"`
          });
        }
      }

      if (lower.includes('Ğ²Ğ²ĞµĞ´Ğ¸') || lower.includes('Ğ²Ğ²Ğ¾Ğ´')) {
        const match = line.match(/'([^']+)'|"([^"]+)"|Â«([^Â«]+)Â»/);
        const text = match ? (match[1] || match[2] || match[3]) : '';
        if (text) {
          actions.push({
            type: 'input',
            value: text,
            description: `Ğ’Ğ²ĞµĞ´Ğ¸: "${text}"`
          });
        }
      }

      if (lower.includes('Ğ¿Ñ€Ğ¾ĞºÑ€ÑƒÑ‚')) {
        actions.push({
          type: 'scroll',
          value: 400,
          description: 'ĞŸÑ€Ğ¾ĞºÑ€ÑƒÑ‚ĞºĞ°'
        });
      }

      if (lower.includes('Ğ¶Ğ´Ğ¸')) {
        actions.push({
          type: 'wait',
          value: 2000,
          description: 'ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ'
        });
      }
    }

    return actions;
  }
}

if (typeof module !== 'undefined' && module.exports) {
  module.exports = GeminiAIAssistant;
}

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘ 6. enhanced-content.js - ĞĞ¡ĞĞĞ’ĞĞĞ™ Ğ¡ĞšĞ Ğ˜ĞŸĞ¢ Ğ ĞĞ‘ĞĞ¢Ğ«                                   â•‘
// â•‘    Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ ĞºĞ°Ğº: enhanced-content.js                                             â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let isRecording = false;
let isAIRunning = false;
let recordedSequence = [];
let aiPanel = null;

function createAIPanel() {
  const panel = document.createElement('div');
  panel.id = 'ai-assistant-panel';
  panel.innerHTML = `
    <div class="ai-panel-inner">
      <div class="ai-panel-header">
        <h2>ğŸ¤– Ğ˜Ğ˜ ĞÑÑĞ¸ÑÑ‚ĞµĞ½Ñ‚</h2>
        <button id="ai-close-btn" class="ai-close-btn">âœ•</button>
      </div>
      
      <div class="ai-panel-content">
        <div class="ai-section">
          <h3>Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¸:</h3>
          <div id="ai-instructions-display" class="ai-instructions-box"></div>
        </div>

        <div class="ai-section">
          <h3>ĞŸÑ€Ğ¾Ñ†ĞµÑÑ:</h3>
          <div id="ai-progress-bar" class="ai-progress-bar">
            <div class="ai-progress-fill"></div>
          </div>
          <div id="ai-current-action" class="ai-current-action">Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ...</div>
        </div>

        <div class="ai-section">
          <h3>Ğ›Ğ¾Ğ³ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹:</h3>
          <div id="ai-actions-log" class="ai-actions-log"></div>
        </div>
      </div>
    </div>
  `;

  document.body.appendChild(panel);
  injectAIPanelStyles();

  document.getElementById('ai-close-btn').addEventListener('click', () => {
    panel.remove();
    stopAIMode();
  });

  return panel;
}

function injectAIPanelStyles() {
  if (document.getElementById('ai-panel-styles')) return;

  const styleSheet = document.createElement('style');
  styleSheet.id = 'ai-panel-styles';
  styleSheet.textContent = `
    #ai-assistant-panel {
      position: fixed;
      right: 0;
      top: 0;
      width: 350px;
      height: 100vh;
      background: #1a1a2e;
      color: #e0e0e0;
      border-left: 3px solid #667eea;
      z-index: 999999;
      font-family: 'Segoe UI', Arial, sans-serif;
      box-shadow: -4px 0 20px rgba(0, 0, 0, 0.5);
      overflow-y: auto;
      animation: aiPanelSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    @keyframes aiPanelSlideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .ai-panel-inner {
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .ai-panel-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 16px;
      border-bottom: 2px solid rgba(255, 255, 255, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
    }

    .ai-panel-header h2 {
      font-size: 16px;
      margin: 0;
      color: white;
      font-weight: 600;
    }

    .ai-close-btn {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      font-size: 20px;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 4px;
      transition: all 0.2s;
    }

    .ai-close-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: scale(1.1);
    }

    .ai-panel-content {
      flex: 1;
      overflow-y: auto;
      padding: 12px;
    }

    .ai-section {
      margin-bottom: 16px;
      background: rgba(255, 255, 255, 0.05);
      padding: 12px;
      border-radius: 6px;
      border-left: 3px solid #667eea;
    }

    .ai-section h3 {
      font-size: 12px;
      color: #667eea;
      margin: 0 0 8px 0;
      text-transform: uppercase;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    #ai-instructions-display {
      font-size: 13px;
      line-height: 1.5;
      color: #b0b0b0;
      max-height: 80px;
      overflow-y: auto;
    }

    .ai-progress-bar {
      width: 100%;
      height: 8px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 8px;
    }

    .ai-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea, #764ba2);
      width: 0%;
      transition: width 0.3s ease;
      border-radius: 4px;
    }

    #ai-current-action {
      font-size: 12px;
      color: #60a5fa;
      background: rgba(96, 165, 250, 0.1);
      padding: 8px;
      border-radius: 4px;
      border-left: 2px solid #60a5fa;
      line-height: 1.4;
    }

    .ai-actions-log {
      font-size: 11px;
      max-height: 200px;
      overflow-y: auto;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 4px;
      padding: 8px;
    }

    .ai-log-item {
      margin-bottom: 6px;
      padding: 6px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 3px;
      border-left: 2px solid #888;
      line-height: 1.3;
    }

    .ai-log-item.success {
      border-left-color: #4ade80;
      color: #4ade80;
    }

    .ai-log-item.error {
      border-left-color: #f87171;
      color: #f87171;
    }

    .ai-log-item.info {
      border-left-color: #60a5fa;
      color: #60a5fa;
    }

    #ai-assistant-panel::-webkit-scrollbar {
      width: 6px;
    }

    #ai-assistant-panel::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
    }

    #ai-assistant-panel::-webkit-scrollbar-thumb {
      background: rgba(102, 126, 234, 0.3);
      border-radius: 3px;
    }

    #ai-assistant-panel::-webkit-scrollbar-thumb:hover {
      background: rgba(102, 126, 234, 0.5);
    }
  `;

  document.head.appendChild(styleSheet);
}

function logToPanel(message, type = 'info') {
  if (!aiPanel) return;

  const log = document.getElementById('ai-actions-log');
  if (!log) return;

  const item = document.createElement('div');
  item.className = `ai-log-item ${type}`;
  const time = new Date().toLocaleTimeString('ru-RU', { 
    hour: '2-digit', 
    minute: '2-digit', 
    second: '2-digit' 
  });
  
  item.innerHTML = `<span style="opacity:0.6;font-size:10px;">[${time}]</span> ${message}`;
  log.appendChild(item);
  log.scrollTop = log.scrollHeight;
}

function updateProgress(current, total) {
  const fill = document.querySelector('.ai-progress-fill');
  if (fill) {
    fill.style.width = `${(current / total) * 100}%`;
  }
}

function updateCurrentAction(action) {
  const current = document.getElementById('ai-current-action');
  if (current) {
    current.textContent = action;
  }
}

function startRecordingMode() {
  isRecording = true;
  recordedSequence = [];
  document.body.classList.add('ai-recording-active');

  const indicator = document.createElement('div');
  indicator.id = 'ai-recording-indicator';
  indicator.innerHTML = `
    <div class="ai-recording-dot"></div>
    <span>Ğ—Ğ°Ğ¿Ğ¸ÑÑŒ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹</span>
  `;
  document.body.appendChild(indicator);

  document.addEventListener('click', recordClick, true);
  document.addEventListener('input', recordInput, true);
  document.addEventListener('change', recordChange, true);

  logToPanel('Ğ—Ğ°Ğ¿Ğ¸ÑÑŒ Ğ½Ğ°Ñ‡Ğ°Ñ‚Ğ°', 'success');
}

function stopRecordingMode() {
  isRecording = false;
  document.body.classList.remove('ai-recording-active');

  const indicator = document.getElementById('ai-recording-indicator');
  if (indicator) indicator.remove();

  document.removeEventListener('click', recordClick, true);
  document.removeEventListener('input', recordInput, true);
  document.removeEventListener('change', recordChange, true);

  logToPanel(`Ğ—Ğ°Ğ¿Ğ¸ÑÑŒ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ°. Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ğ½Ğ¾ ${recordedSequence.length} Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹`, 'info');
}

function recordClick(e) {
  if (!isRecording) return;

  const target = e.target;
  const action = {
    type: 'click',
    timestamp: Date.now(),
    selector: generateSelector(target),
    text: target.innerText?.substring(0, 50) || '',
  };

  recordedSequence.push(action);

  target.classList.add('ai-highlight-element');
  setTimeout(() => target.classList.remove('ai-highlight-element'), 300);

  chrome.runtime.sendMessage({ type: 'actionRecorded', data: action }).catch(() => {});
}

function recordInput(e) {
  if (!isRecording) return;

  const target = e.target;
  if (target.tagName !== 'INPUT' && target.tagName !== 'TEXTAREA') return;

  const action = {
    type: 'input',
    timestamp: Date.now(),
    selector: generateSelector(target),
    value: target.value,
    placeholder: target.placeholder || '',
    inputType: target.type || 'text'
  };

  recordedSequence.push(action);
  chrome.runtime.sendMessage({ type: 'actionRecorded', data: action }).catch(() => {});
}

function recordChange(e) {
  if (!isRecording) return;

  const target = e.target;
  if (target.tagName === 'SELECT') {
    const action = {
      type: 'select',
      timestamp: Date.now(),
      selector: generateSelector(target),
      value: target.value,
      text: target.options[target.selectedIndex]?.text || ''
    };

    recordedSequence.push(action);
    chrome.runtime.sendMessage({ type: 'actionRecorded', data: action }).catch(() => {});
  }
}

function generateSelector(element) {
  if (element.id) return `#${element.id}`;
  if (element.className) return `.${element.className.split(' ')[0]}`;
  return element.tagName.toLowerCase();
}

function findElement(selector) {
  try {
    let el = document.querySelector(selector);
    if (el) return el;

    el = document.getElementById(selector.replace('#', ''));
    if (el) return el;

    const elements = document.querySelectorAll('button, a, input, [role="button"]');
    for (const element of elements) {
      if (element.innerText?.toLowerCase().includes(selector.toLowerCase())) {
        return element;
      }
    }

    return null;
  } catch (e) {
    return null;
  }
}

async function executeAIInstructions(instructions, apiKey) {
  isAIRunning = true;
  aiPanel = createAIPanel();

  document.getElementById('ai-instructions-display').textContent = instructions;
  logToPanel('ğŸ¤– Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ°ÑÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ°...', 'info');

  const actions = parseInstructions(instructions);
  logToPanel(`ğŸ“‹ Ğ Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ½Ğ¾ ${actions.length} Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹`, 'info');

  updateProgress(0, actions.length);

  for (let i = 0; i < actions.length && isAIRunning; i++) {
    const action = actions[i];
    updateProgress(i, actions.length);
    updateCurrentAction(`Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ: ${action.description}`);

    logToPanel(`â–¶ Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ ${i + 1}/${actions.length}: ${action.description}`, 'info');

    try {
      await executeAction(action);
      logToPanel(`âœ“ Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾`, 'success');
    } catch (err) {
      logToPanel(`âœ— ĞÑˆĞ¸Ğ±ĞºĞ°: ${err.message}`, 'error');
    }

    await delay(600);
  }

  updateProgress(actions.length, actions.length);
  updateCurrentAction('âœ“ Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾!');
  logToPanel('ğŸ‰ Ğ’ÑĞµ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ñ‹!', 'success');
}

function parseInstructions(instructions) {
  const actions = [];
  const lines = instructions.split('\n').filter(l => l.trim());

  for (const line of lines) {
    const lower = line.toLowerCase();

    if (lower.includes('ĞºĞ»Ğ¸Ğº') || lower.includes('Ğ½Ğ°Ğ¶Ğ¼Ğ¸') || lower.includes('click')) {
      const match = line.match(/'([^']+)'|"([^"]+)"|Â«([^Â«]+)Â»|Ğ½Ğ° (.+?)(?:\s|$)/i);
      const text = match ? (match[1] || match[2] || match[3] || match[4]) : line.split(/Ğ½Ğ°|Ğ¿Ğ¾|Ğ½Ğ° ĞºĞ½Ğ¾Ğ¿ĞºÑƒ/i)[1]?.trim();
      if (text && text.trim().length > 0) {
        actions.push({
          type: 'click',
          text: text.trim(),
          description: `ĞšĞ»Ğ¸Ğº Ğ½Ğ° "${text.trim()}"`
        });
      }
    }

    if (lower.includes('Ğ²Ğ²ĞµĞ´Ğ¸') || lower.includes('Ğ²Ğ²Ğ¾Ğ´') || lower.includes('type')) {
      const match = line.match(/'([^']+)'|"([^"]+)"|Â«([^Â«]+)Â»/);
      const text = match ? (match[1] || match[2] || match[3]) : '';
      if (text) {
        actions.push({
          type: 'input',
          text: text,
          description: `Ğ’Ğ²ĞµĞ´Ğ¸ Ñ‚ĞµĞºÑÑ‚: "${text}"`
        });
      }
    }

    if (lower.includes('Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸') || lower.includes('select')) {
      const match = line.match(/'([^']+)'|"([^"]+)"/);
      const text = match ? (match[1] || match[2]) : '';
      if (text) {
        actions.push({
          type: 'select',
          text: text,
          description: `Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸: "${text}"`
        });
      }
    }

    if (lower.includes('Ğ¿Ñ€Ğ¾ĞºÑ€ÑƒÑ‚')) {
      actions.push({
        type: 'scroll',
        pixels: 400,
        description: 'ĞŸÑ€Ğ¾ĞºÑ€ÑƒÑ‚ĞºĞ° Ğ²Ğ½Ğ¸Ğ·'
      });
    }

    if (lower.includes('Ğ¶Ğ´Ğ¸') || lower.includes('Ğ¿Ğ¾Ğ´Ğ¾Ğ¶Ğ´Ğ¸') || lower.includes('wait')) {
      actions.push({
        type: 'wait',
        duration: 2000,
        description: 'ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ'
      });
    }
  }

  return actions;
}

async function executeAction(action) {
  switch (action.type) {
    case 'click': {
      const el = findElement(action.text);
      if (!el) throw new Error(`Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½: ${action.text}`);
      el.click();
      break;
    }

    case 'input': {
      const input = document.querySelector('input:focus, input[type="text"], textarea');
      if (!input) throw new Error('ĞŸĞ¾Ğ»Ğµ Ğ²Ğ²Ğ¾Ğ´Ğ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾');
      input.focus();
      input.value = action.text;
      input.dispatchEvent(new Event('input', { bubbles: true }));
      input.dispatchEvent(new Event('change', { bubbles: true }));
      break;
    }

    case 'select': {
      const select = document.querySelector('select');
      if (!select) throw new Error('Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½');
      select.value = action.text;
      select.dispatchEvent(new Event('change', { bubbles: true }));
      break;
    }

    case 'scroll': {
      window.scrollBy(0, action.pixels);
      break;
    }

    case 'wait': {
      await delay(action.duration);
      break;
    }
  }
}

function stopAIMode() {
  isAIRunning = false;
  logToPanel('â¸ ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¼', 'info');
}

function delay(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
  if (request.action === 'startRecording') {
    startRecordingMode();
  } else if (request.action === 'stopRecording') {
    stopRecordingMode();
  } else if (request.action === 'playActions') {
    // Ğ’Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ ÑƒĞ¶Ğµ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ½Ğ¾ Ğ² popup.js
  } else if (request.action === 'startAIMode') {
    executeAIInstructions(request.instructions, request.geminiApiKey);
  } else if (request.action === 'stopAIMode') {
    stopAIMode();
  }

  sendResponse({ success: true });
});

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘ 7. settings.html - Ğ¡Ğ¢Ğ ĞĞĞ˜Ğ¦Ğ ĞĞĞ¡Ğ¢Ğ ĞĞ•Ğš API ĞšĞ›Ğ®Ğ§Ğ                                    â•‘
// â•‘    Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ ĞºĞ°Ğº: settings.html                                                   â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ˜Ğ˜-ĞĞ²Ñ‚Ğ¾ĞºĞ»Ğ¸ĞºĞµÑ€</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .settings-container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    }

    h1 {
      color: #667eea;
      margin-bottom: 10px;
      font-size: 28px;
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .settings-section {
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid #eee;
    }

    .settings-section:last-child {
      border-bottom: none;
    }

    .setting-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: 600;
      font-size: 14px;
    }

    .label-description {
      display: block;
      margin-bottom: 4px;
      color: #666;
      font-size: 13px;
      font-weight: 400;
      margin-top: 2px;
    }

    input[type="text"],
    input[type="password"],
    select {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.3s;
    }

    input[type="text"]:focus,
    input[type="password"]:focus,
    select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    button {
      flex: 1;
      padding: 12px 20px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-save {
      background: #667eea;
      color: white;
    }

    .btn-save:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .btn-test {
      background: #28a745;
      color: white;
    }

    .btn-test:hover {
      background: #218838;
    }

    .btn-reset {
      background: #dc3545;
      color: white;
    }

    .btn-reset:hover {
      background: #c82333;
    }

    .status-message {
      margin-top: 15px;
      padding: 12px;
      border-radius: 6px;
      font-size: 13px;
      display: none;
    }

    .status-message.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
      display: block;
    }

    .status-message.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
      display: block;
    }

    .info-box {
      background: #f0f1ff;
      border-left: 3px solid #667eea;
      padding: 12px;
      border-radius: 4px;
      font-size: 13px;
      color: #333;
      margin-bottom: 15px;
      line-height: 1.5;
    }

    .info-box a {
      color: #667eea;
      text-decoration: none;
      font-weight: 600;
    }

    .info-box a:hover {
      text-decoration: underline;
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: 0.4s;
      border-radius: 24px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: 0.4s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: #667eea;
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }

    .toggle-group {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-top: 10px;
    }

    .toggle-label {
      font-weight: 600;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="settings-container">
    <h1>âš™ï¸ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ˜Ğ˜-ĞĞ²Ñ‚Ğ¾ĞºĞ»Ğ¸ĞºĞµÑ€</h1>
    <p class="subtitle">ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ˜Ğ˜ Ğ°ÑÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ° Ğ¸ Ğ¾Ğ±Ñ‰Ğ¸Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹</p>

    <div class="settings-section">
      <h2 style="color: #333; margin-bottom: 15px; font-size: 18px;">ğŸ¤– Google Gemini API</h2>

      <div class="info-box">
        ğŸ“Œ ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚Ğµ Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ñ‹Ğ¹ API ĞºĞ»ÑÑ‡ Ğ½Ğ° 
        <a href="https://makersuite.google.com/app/apikey" target="_blank">Google AI Studio</a>
        (1000 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ² Ğ´ĞµĞ½ÑŒ Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾)
      </div>

      <div class="setting-group">
        <label for="gemini-api-key">API ĞšĞ»ÑÑ‡ Gemini</label>
        <span class="label-description">Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ´Ğ»Ñ ÑƒĞ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¹</span>
        <input 
          type="password" 
          id="gemini-api-key" 
          placeholder="sk-..."
          autocomplete="off"
        >
      </div>

      <div class="toggle-group">
        <label class="toggle-label">Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Gemini</label>
        <label class="switch">
          <input type="checkbox" id="gemini-enabled" checked>
          <span class="slider"></span>
        </label>
      </div>

      <div class="button-group">
        <button class="btn-test" onclick="testGeminiAPI()">ğŸ§ª Ğ¢ĞµÑÑ‚</button>
        <button class="btn-reset" onclick="clearGeminiKey()">ğŸ—‘ï¸ Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ</button>
      </div>

      <div id="gemini-status" class="status-message"></div>
    </div>

    <div class="button-group" style="margin-top: 30px;">
      <button class="btn-save" onclick="saveSettings()">âœ“ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ</button>
    </div>

    <div id="main-status" class="status-message"></div>
  </div>

  <script src="settings.js"></script>
</body>
</html>

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘ 8. settings.js - Ğ›ĞĞ“Ğ˜ĞšĞ Ğ¡Ğ¢Ğ ĞĞĞ˜Ğ¦Ğ« ĞĞĞ¡Ğ¢Ğ ĞĞ•Ğš                                         â•‘
// â•‘    Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ ĞºĞ°Ğº: settings.js                                                     â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

document.addEventListener('DOMContentLoaded', loadSettings);

function loadSettings() {
  chrome.storage.sync.get(
    [
      'geminiApiKey',
      'geminiEnabled',
    ],
    (result) => {
      document.getElementById('gemini-api-key').value = result.geminiApiKey || '';
      document.getElementById('gemini-enabled').checked = result.geminiEnabled !== false;
    }
  );
}

function saveSettings() {
  const settings = {
    geminiApiKey: document.getElementById('gemini-api-key').value,
    geminiEnabled: document.getElementById('gemini-enabled').checked,
  };

  chrome.storage.sync.set(settings, () => {
    showStatus('success', 'main-status', 'âœ“ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ñ‹ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾!');
  });
}

async function testGeminiAPI() {
  const apiKey = document.getElementById('gemini-api-key').value.trim();
  const statusEl = document.getElementById('gemini-status');

  if (!apiKey) {
    showStatus('error', 'gemini-status', 'âœ— ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ API ĞºĞ»ÑÑ‡');
    return;
  }

  showStatus('info', 'gemini-status', 'â³ Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ...');

  try {
    const response = await fetch(
      'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=' + apiKey,
      {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          contents: [
            {
              parts: [
                {
                  text: 'Ğ¡ĞºĞ°Ğ¶Ğ¸ Ğ¾Ğ´Ğ½Ğ¾ ÑĞ»Ğ¾Ğ²Ğ¾ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼'
                }
              ]
            }
          ]
        })
      }
    );

    if (response.ok) {
      const data = await response.json();
      if (data.candidates && data.candidates[0]) {
        showStatus('success', 'gemini-status', 'âœ“ ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾! Gemini Ğ³Ğ¾Ñ‚Ğ¾Ğ² Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğµ.');
        chrome.storage.sync.set({ geminiApiKey: apiKey });
      } else {
        showStatus('error', 'gemini-status', 'âœ— ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚ Ğ¾Ñ‚ API');
      }
    } else {
      const error = await response.json();
      showStatus(
        'error',
        'gemini-status',
        `âœ— ĞÑˆĞ¸Ğ±ĞºĞ°: ${error.error?.message || response.statusText}`
      );
    }
  } catch (error) {
    showStatus('error', 'gemini-status', `âœ— ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ: ${error.message}`);
  }
}

function clearGeminiKey() {
  if (confirm('Ğ’Ñ‹ ÑƒĞ²ĞµÑ€ĞµĞ½Ñ‹? API ĞºĞ»ÑÑ‡ Ğ±ÑƒĞ´ĞµÑ‚ ÑƒĞ´Ğ°Ğ»ĞµĞ½.')) {
    document.getElementById('gemini-api-key').value = '';
    chrome.storage.sync.set({ geminiApiKey: '' });
    showStatus('success', 'gemini-status', 'âœ“ API ĞºĞ»ÑÑ‡ ÑƒĞ´Ğ°Ğ»ĞµĞ½');
  }
}

function showStatus(type, elementId, message) {
  const el = document.getElementById(elementId);
  if (!el) return;

  el.className = `status-message ${type}`;
  el.textContent = message;

  if (type === 'success' || type === 'info') {
    setTimeout(() => {
      el.className = 'status-message';
    }, 4000);
  }
}

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘ 9. background.js - SERVICE WORKER (Ğ¤ĞĞĞĞ’Ğ«Ğ™ Ğ¡Ğ•Ğ Ğ’Ğ˜Ğ¡)                                â•‘
// â•‘    Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ ĞºĞ°Ğº: background.js                                                   â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

chrome.runtime.onInstalled.addListener(() => {
  console.log('Ğ˜Ğ˜-ĞĞ²Ñ‚Ğ¾ĞºĞ»Ğ¸ĞºĞµÑ€ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½!');
});

chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
  if (request.type === 'actionRecorded') {
    chrome.runtime.sendMessage({
      type: 'actionRecorded',
      data: request.data
    }).catch(() => {});
  }
});

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘ 10. content.css - Ğ¡Ğ¢Ğ˜Ğ›Ğ˜ Ğ­Ğ›Ğ•ĞœĞ•ĞĞ¢ĞĞ’ ĞĞ Ğ¡Ğ¢Ğ ĞĞĞ˜Ğ¦Ğ•                                     â•‘
// â•‘    Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ ĞºĞ°Ğº: content.css                                                     â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

#ai-recording-indicator {
  position: fixed;
  bottom: 20px;
  left: 20px;
  background: #dc3545;
  color: white;
  padding: 10px 15px;
  border-radius: 50px;
  font-size: 12px;
  font-weight: 600;
  z-index: 999998;
  display: flex;
  align-items: center;
  gap: 8px;
  box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
  animation: pulse 1s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

.ai-recording-dot {
  width: 8px;
  height: 8px;
  background: white;
  border-radius: 50%;
  animation: dot-pulse 1s infinite;
}

@keyframes dot-pulse {
  0%, 100% { 
    opacity: 1;
    transform: scale(1);
  }
  50% { 
    opacity: 0.5;
    transform: scale(1.2);
  }
}

.ai-highlight-element {
  outline: 3px solid #667eea !important;
  outline-offset: 2px !important;
  background-color: rgba(102, 126, 234, 0.1) !important;
  transition: all 0.2s;
}

body.ai-recording-active {
  cursor: crosshair;
}

/**
 * ========================================================================================
 * ĞšĞĞĞ•Ğ¦ ĞšĞĞ”Ğ
 * ========================================================================================
 * 
 * Ğ’Ğ¡Ğ Ğ¡ĞšĞĞŸĞ˜Ğ ĞĞ’ĞĞĞ? Ğ”Ğ•Ğ™Ğ¡Ğ¢Ğ’Ğ£Ğ™Ğ¢Ğ•:
 * 
 * 1. Ğ Ğ°Ğ·Ğ´ĞµĞ»Ğ¸Ñ‚Ğµ ĞºĞ¾Ğ´ Ğ¿Ğ¾ ÑĞµĞºÑ†Ğ¸ÑĞ¼ (1-10)
 * 2. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚Ğµ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ» Ñ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ñ‹Ğ¼ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼
 * 3. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ¿Ğ°Ğ¿ĞºÑƒ images/ Ñ Ğ¸ĞºĞ¾Ğ½ĞºĞ°Ğ¼Ğ¸
 * 4. ĞŸĞ¾Ğ¼ĞµÑÑ‚Ğ¸Ñ‚Ğµ Ğ²ÑĞµ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ² Ğ¾Ğ´Ğ½Ñƒ Ğ¿Ğ°Ğ¿ĞºÑƒ ai-autoclicker/
 * 5. ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ chrome://extensions/
 * 6. Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚Ğµ "Ğ ĞµĞ¶Ğ¸Ğ¼ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ°"
 * 7. ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ "Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ñ€Ğ°ÑĞ¿Ğ°ĞºĞ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ğµ"
 * 8. Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ¿Ğ°Ğ¿ĞºÑƒ ai-autoclicker/
 * 9. Ğ“ĞĞ¢ĞĞ’Ğ!
 * 
 * ========================================================================================
 */
